<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ item.title_jp }}</title>
    <link href="[https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,700&family=Noto+Serif+JP&display=swap](https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,700&family=Noto+Serif+JP&display=swap)" rel="stylesheet">
    <style>
        :root { --bg: #ffffff; --navy: #001f3f; --gold: #c5a059; --light-gold: #fdfaf4; }
        body { font-family: 'Noto Serif JP', serif; margin: 0; background: var(--bg); line-height: 2; color: #333; }
        .back-nav { padding: 40px; }
        .back-nav a { text-decoration: none; color: var(--gold); font-family: 'Playfair Display', serif; font-size: 1.1rem; }
        
        article { max-width: 750px; margin: 0 auto; padding: 0 20px 100px; }
        h1 { font-size: 2.8rem; line-height: 1.2; color: var(--navy); margin-bottom: 40px; border-bottom: 2px solid var(--gold); padding-bottom: 20px; }
        .meta { font-family: 'Playfair Display', serif; color: var(--gold); margin-bottom: 60px; font-style: italic; }
        
        .section-box { margin: 80px 0; padding: 40px; background: var(--light-gold); border-radius: 4px; border-left: 1px solid var(--gold); }
        .critique-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--gold); margin-bottom: 20px; display: block; }
        
        .hints { display: flex; gap: 40px; margin: 60px 0; }
        .hint-card { flex: 1; border: 1px solid #eee; padding: 30px; }
        .hint-card strong { color: var(--gold); display: block; margin-bottom: 10px; }

        .proverb-footer { background: var(--navy); color: white; padding: 60px; text-align: center; margin-top: 100px; }
        .term-hl { border-bottom: 1px solid var(--gold); cursor: pointer; transition: 0.3s; }
        .term-hl:hover { background: var(--light-gold); }

        #popup { position: fixed; bottom: -120px; left: 0; width: 100%; background: var(--navy); color: white; padding: 30px; transition: 0.4s; text-align: center; box-sizing: border-box; }
        #popup.active { bottom: 0; }
        .en, .jp { display: none; }
    </style>
</head>
<body>
    <div class="back-nav"><a href="../index.html">← RETURN</a> <button onclick="toggleLang()" style="float:right">JP/EN</button></div>

    <article>
        <span class="meta">{{ item.date }} | BY THE CRIMSON PEN</span>
        <h1 class="jp">{{ item.title_jp }}</h1><h1 class="en">{{ item.title_en }}</h1>
        
        <div id="main-content">
            <div class="jp" id="text-jp">{{ item.content_jp | replace('\n', '<br>') }}</div>
            <div class="en" id="text-en">{{ item.content_en | replace('\n', '<br>') }}</div>
        </div>

        <div class="section-box">
            <span class="critique-title">The Sharp Critique</span>
            <div class="jp">{{ item.critique_jp }}</div><div class="en">{{ item.critique_en }}</div>
        </div>

        <div class="hints">
            <div class="hint-card">
                <strong>INVESTMENT</strong>
                <p class="jp">{{ item.investment_hint_jp }}</p><p class="en">{{ item.investment_hint_en }}</p>
            </div>
            <div class="hint-card">
                <strong>LIFE HINT</strong>
                <p class="jp">{{ item.life_hint_jp }}</p><p class="en">{{ item.life_hint_en }}</p>
            </div>
        </div>
    </article>

    <div class="proverb-footer">
        <div class="jp">「{{ item.proverb.title_jp }}」</div><div class="en">"{{ item.proverb.title_en }}"</div>
        <p class="jp" style="opacity: 0.8">{{ item.proverb.desc_jp }}</p><p class="en" style="opacity: 0.8">{{ item.proverb.desc_en }}</p>
    </div>

    <div id="popup"><strong id="p-term"></strong>: <span id="p-def"></span></div>

    <script>
        const glossary = {{ item.glossary | tojson }};
        let lang = localStorage.getItem('lang') || 'jp';
        function toggleLang() { lang = lang === 'jp' ? 'en' : 'jp'; localStorage.setItem('lang', lang); location.reload(); }

        function showPop(t, d) {
            document.getElementById('p-term').innerText = t;
            document.getElementById('p-def').innerText = d;
            document.getElementById('popup').classList.add('active');
            setTimeout(() => document.getElementById('popup').classList.remove('active'), 7000);
        }

        ['jp', 'en'].forEach(l => {
            const container = document.getElementById('text-' + l);
            let html = container.innerHTML;
            glossary.forEach(g => {
                const t = l === 'jp' ? g.term_jp : g.term_en;
                const d = l === 'jp' ? g.def_jp : g.def_en;
                html = html.replace(new RegExp(t, 'g'), `<span class="term-hl" onclick="showPop('${t}','${d}')">${t}</span>`);
            });
            container.innerHTML = html;
        });
        document.querySelectorAll('.' + lang).forEach(e => e.style.display = 'block');
    </script>
</body>
</html>
